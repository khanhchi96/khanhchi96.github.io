<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
<style>
    .first-footer{
        bottom: 0!important;
    }
    .secondary-footer{
        display: none;
    }
    .active{
        background-color: transparent!important;
    }
    .row{
        margin-bottom: 30px!important;
    }

    .input-field.col{
        width: 70%;
    }

    .cart-value{
        background-color: green!important;
        color: #fff!important;
    }
    @media (min-width: 993px){
        .cart-value{
            top: 50px!important;
        }
        .fixed-bill{
            top: 130px!important;
        }
        .measurements-cart>div {
    flex-basis: calc(19% - 17px)!important;
    }}


</style>
</head>
<body>
    <header class="header"> 
        <div class="header-wrap">      
            <nav id="nav-large" chi-include-html="menu.html"></nav>
        </div>
    </header>

    <section style="margin-bottom: 50px;">
        <div class="wrap">
            <div class="progressbar-container">
                <ul class="progressbar">
                    <li class="progress-active">Đăng nhập/Đăng ký</li>
                    <!-- <li class="step2">Địa chỉ giao hàng</li> -->
                    <li class="step3">Thanh toán & Đặt mua</li>    
                </ul>
            </div>
        </div>


        <div class="wrap payment-wrap">
                <div class="cart-value">
                        <h3>Mã giảm giá: <span id="discount-code"></span></h3>
                        <h3>Tổng tiền: <span id="bill-value"></span>VNĐ</h3>
                </div>
                    <form class="payment">
                        <h1>Địa chỉ giao hàng</h1>

                    <div class="row">
                        <div class="input-field col">
                          <input id="customer-name" type="text" class="validate">
                          <label for="customer-name">Họ tên khách hàng</label>
                        </div>
                    </div>

                    <div class="row">
                        <div class="input-field col">
                          <input id="customer-address" type="text" class="validate">
                          <label for="customer-address">Địa chỉ</label>
                        </div>
                    </div>

                    <div class="row">
                        <div class="input-field col">
                          <input id="customer-phone" type="text" class="validate">
                          <label for="customer-phone">Số điện thoại</label>
                        </div>
                    </div>


                        <h1>Phương thức thanh toán</h1>

                        <p>
                            <label>
                              <input name="payment" type="radio" onclick="show1()" />
                              <span>Chuyển khoản ngân hàng</span>
                            </label>
                            
                            <div class="transfer-info">
                                <p>THÔNG TIN CHUYỂN KHOẢN:</p>
                                <p>STK: 0011004215063<br>Chủ tài khoản: PHUNG KHANH CHI<br/> Ngân hàng: Vietcombank Chi nhánh Chùa Láng</p>
                            </div>
                        </p>

                        <p>
                            <label>
                              <input name="payment" type="radio" id ="bank-card" onclick="show2()" />
                              <span>Thẻ ngân hàng</span>
                            </label>

                            <div class="bank-card-option">
                                <label>     
                                    <input name="card" type="radio" id="visa" onclick="show4()" />
                                    <span><i class="fab fa-cc-visa"></i></span>
                                </label> 
                                
                                <label>     
                                    <input name="card" type="radio" id="mastercard" onclick="show4()" />
                                    <span><i class="fab fa-cc-mastercard"></i></span>
                                </label> 

                                <label>     
                                    <input name="card" type="radio" id="amex" onclick="show4()" />
                                    <span><i class="fab fa-cc-amex"></i></span>
                                </label> 

                                <label>     
                                    <input name="card" type="radio" id="domestic" onclick="show4()" />
                                    <span>Thẻ ngân hàng nội địa</span>
                                </label> 
                            </div>    
                                <div class="bank-card-info">
                                    <p>Số thẻ:<input id="number" type="text"/></p>
                                    <p>Tên chủ thẻ:<input id="name" type="text"/></p>
                                    <p>Ngày hết hạn:<input id="date" type="text"/></p>
                                </div>
                        </p>
                        <p>
                            <label>
                              <input name="payment" type="radio" id="e-wallet" onclick="show3()" />
                              <span>Ví điện tử</span>
                            </label>
                        </p>
                        <button type="button" id="complete">Tiến hành đặt hàng</button><br/>
                    </form>
            </div>
    
    </section>
    <footer chi-include-html="footer.html"></footer>
        



    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="script/script.js"></script>
    <script src="script/order.js"></script>
    <script>
    
    let orderInfo = JSON.parse(localStorage.getItem("productGroup"));
        let groupPrice = [];
        $(document).ready(function() {
            for(var i=0; i < orderInfo.length; i++ ){                        
                let priceString;
                priceString= orderInfo[i].productPrice.match(/\d/g).join("");
                let price=parseInt(priceString);
                groupPrice.push(price);

            }
            let totalValue = 0;
                totalValue = groupPrice.reduce(function(a, b) { return a + b; }, 0);
                $('#bill-value').text(totalValue.toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."));

        
        });

    
    let customerInfo = {};

    $('#complete').click(function (e) {
            let isValid = true;
            $('.shipping>input[type=text]').each(function(){
            if ($.trim($(this).val()) == ""){
                $('.error').text('Vui lòng cung cấp đầy đủ thông tin!')
                isValid = false;
                
            } else {
                $('.error').text('');
            }
        });
            if (!$("input[name='payment']:checked").val()) {
                $('.warning').text('Hãy chọn phương thức thanh toán!');
                isValid = false;
                
            } else if ($('#bank-card').prop('checked') && !$("input[name='card']:checked").val()){
                $('.warning').text('Hãy chọn phương thức thanh toán!');
                isValid = false;
            }
            else if ($('#bank-card').prop('checked') && ($('#visa').prop('checked') || $('#mastercard').prop('checked') || $('#amex').prop('checked') || $('#domestic').prop('checked')  )
            && ($('#number').text().trim() == "" || $('#name').text().trim() == "" ||$ ('#date').text().trim() == "")){
                $('.warning').text('Hãy điền đầy đủ thông tin!');
                isValid = false;
            }
            else {
                $('.error').text('');
            }
        if (isValid == false) e.preventDefault();

        else {
            customerInfo = JSON.parse(localStorage.getItem('customerInfo')) || {};
            customerInfo.name = $('#customer-name').val();
            customerInfo.address = $('#customer-address').val();
            customerInfo.phone = $('#customer-phone').val();
            customerInfo.paymentMethod = $("input[name='payment']:checked").val();
            localStorage.setItem('customerInfo', JSON.stringify(customerInfo));
            location.href = "confirm.html";
        }
    })

    function show1(){
        $('.transfer-info').css('display', 'block');
        $('.bank-card-option').css('display', 'none');
        $('.bank-card-info').css('display', 'none');
        scrollBottom();
    }
    function show2(){
        $('.bank-card-option').css('display', 'block');
        $('.transfer-info').css('display', 'none');
        scrollBottom();
    }

    function show3(){
        $('.transfer-info').css('display', 'none');
        $('.bank-card-option').css('display', 'none');
        $('.bank-card-info').css('display', 'none');
    }

    function show4(){
        $('.bank-card-info').css('display', 'block');
        scrollBottom();
    }
            
    </script>
        <script>
            includeHTML();
        </script>
</body>
</html>